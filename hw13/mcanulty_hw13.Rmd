---
title: "HW13: Strings and Things"
author: "Ryan McAnulty"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

## Loading required libraries
```{r}
library(tidyverse)
library(here)
library(ggthemes)
library(gghighlight)
```
## From many strings to one
```{r}
beta <-                                   # Naming imported data
  read_lines(here("data",                 # Importing "beta_gliadin.txt"   
                  "beta_gliadin.txt"),
                  skip = 1)               # Skipping meta data

DNA <- beta %>%                           # Saving changes
  str_replace_all("[:digit:]",            # Removing numerals and replacing with nothing
                  "") %>%         
  str_replace_all("[:space:]",            # Removing white spaces and replacing with nothing
                  "") %>%          
  str_c(collapse = "") %>%                # Collapsing 56 strings into one
  str_to_upper()                          # Converting to all Upper case characters

DNA                                       # Displaying string to prove changes worked
str_count(DNA)
```
There are 3310 characters
## Sequence analysis: find the promoter region
## Counting non ACTG
```{r}
str_count(DNA,
          "[^ACTG]")   # REGEX anything but
```
There are 0 non A, C, T, or G characters.

# Counting starting codon ATG
```{r}
str_count(DNA,
          "ATG")
```
66 ATGs.

## Counting stop codon TGA or TAA
```{r}
str_count(DNA, 
          "TGA|TAA")  # or
```
99 TGAs or TAAs.

## Finding Promoter region
## Assigning "CAAT box" and "TATA box"
```{r}
caat_box <- "CCAAT"
tata_box <- "CTATAA"
```
## Counting strings
```{r}
str_count(DNA,  
          caat_box)                    # There are 4 instances of "CCAAT" in the string
str_count(DNA, 
          tata_box)                    # There is 1 instance of #CTATAA" in the string 

caat_seq <- "CCAAT.{100,150}ATG"       # Making a sequence search that searches for a sequence that starts with "CCAAT" and ends with the stop codon "ATG" with 100 to 150 nucleotides in between
str_count(DNA, 
          caat_seq)                    # There are 2 such sequences
tata_seq <- "CTATAA.{50,100}ATG"       # Making a sequence search that searches for a sequence that starts with "CTATAA" and ends with the stop codon "ATG" with 50 to 100 nucleotides
str_count(DNA, 
          tata_seq)                    # Just 1 of these
caat_seqs_all <- 
  str_extract_all(DNA,                 # Extracting the two "CTATAA" sequences
                  caat_seq, 
                  simplify = TRUE)
str_length(caat_seqs_all)              # Lengths are 139 and 148 respectivley for these two
str_which(caat_seqs_all, tata_box)     # Searching for sequence that contains the "TATA box"
promoter <- str_sub(caat_seqs_all[1])  # Naming this promoter
promoter                               # Displaying promoter
str_length(promoter)                   # Sequence length is the shorter 139 length seq
```
#### Part 2: Ants
## Import the data
```{r}
ants<- read_csv(here("Data", "ants.csv"))
ants
```

## Wrangle the data
```{r}
wrangled_ants <- ants %>% 
  pivot_longer(names_to = "species", 
               values_to = "abundance", 
               matches("[:Upper:].+\\.[:lower:].+", 
                       ignore.case = FALSE)) %>% 
  select(year, 
         species, 
         abundance)
wrangled_ants
```
`

#### Part 3: Featuring Phlox Flowers
## Import and wrangle data
```{r}
flower_size <- read.csv(here("data",
                             "flower_size.csv"))  # Importing Flower_size data   
  
flower_size_summary <- flower_size %>%
  drop_na(Flower.number) %>%                      # Dropping nas in column Flower.number
  select("Species",                               # Selecting "Species", "cor_length", "throat_width", renaming the latter two
         "cor_length" = 
           Corolla.length..cm.,
         "throat_width" = 
           Corolla.width.throat..cm.) %>% 
  separate(Species,                               # Separating the species column into genus and species  
           into = c("genus", 
                    "species"), 
           sep = " ") %>%                         # Denoting the deliminator is a space
  group_by(genus, species) %>%                    # Grouping by genus and species
  summarise("mean_length" = mean(cor_length),     # Creating summary for mean length, mean width, max length and max width
            "mean_width" = mean(throat_width),
            "max_length" = max(cor_length),
            "max_width" = max(throat_width),      
  .groups = "drop")                               # Dropping groups 
```

## Importing and wrangling the second data set
```{r}
pollinators_raw <- read.csv(here("data", 
                                 "flower_pollinators.csv"))  # Importing data

pollinators <- pollinators_raw %>%                 # Naming data
  select(-(starts_with("Source") | Color)) %>%     # Removing "Source" and Color columns
  filter(Pollinator != "") %>%                     # Filtering out NAs
  separate(Ã¯..Species,                             # Separating species into genus and species
            into = c("genus",
                     "species"),
            sep = " ") %>%  
  separate(Pollinator, 
           into = c("Syndrome"))
pollinators

```
## Using inner_join to combine data sets
```{r}
phlox <- inner_join(flower_size_summary,
                    pollinators)
phlox
```

## Plotting Part 3
```{r}
phlox %>% 
  ggplot(mapping = aes(x = mean_length, 
                       y = mean_width, 
                       color = Syndrome))+    # Scatter plot of phlox
           geom_point() +
           labs(x = "Mean length",            # Renaming axes 
                y = "Mean width")
```



